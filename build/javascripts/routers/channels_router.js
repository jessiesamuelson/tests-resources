RailsApi.Routers.Channels=Backbone.Router.extend({routes:{"new":"addChannel",search:"searchChannels"},initialize:function(){this.authenticateApi(),this.fetchChannels(".all-channels .channel-list",baseUrl+"/channels",".all-channels .pagination")},fetchChannels:function(n,e,a){var t=this;this.channels=new RailsApi.Collections.Channels,this.channelListView=new RailsApi.Views.ChannelListView({collection:this.channels,el:$(n)}),this.channels.url=e,this.channels.fetch({async:!1}).done(function(n){clearResultButton(),0===n.channels.length?notify("No channel found.","error"):(t.pagination=new Pagination(a,n.pagination),t.changePage(),t.channelListView.render())})},authenticateApi:function(){$.ajaxSetup({headers:{Accept:"application/json",Authorization:"Token token="+apiKey}})},addChannel:function(){var n=this;$("#new-channel").submit(function(e){e.preventDefault();var a=$('input[name="name"]').val(),t=$('input[name="src"]').val(),i=$('input[name="href"]').val(),c=$('input[name="category_array"]').val().toLowerCase().split(","),l=$('input[name="desc"]').val(),s=$(this.el).find('input[name="keywords"]').val(),r=$('input[name="twitter_widget_id"]').val(),h=($('input[name="community_site_id"]').val(),$('input[name="banner_img"]').val()),o=$('input[name="mobile_banner"]').val(),u=$('input[name="curator_name"]').val(),p=$('input[name="curator_img"]').val(),f=$('input[name="curator_video"]').val(),m=$('input[name="curator_desc"]').val(),d=new RailsApi.Models.Channel({name:a,src:t,href:i,category_array:c,desc:l,keywords:s,twitter_widget_id:r,banner_img:h,mobile_banner:o,curator_name:u,curator_img:p,curator_video:f,curator_desc:m});d.url=baseUrl+"/channels",d.save(null,{success:function(n){notify(n.attributes.msg,"success")}},{error:function(n){notify(n.attributes.msg,"error")}}),n.channels.fetch(),$("#new-channel").find('input[type="text"]').val("")})},changePage:function(){var n=this;this.pagination.$el.click(function(e){var a=n.pagination.change($(e.target));void 0!=a&&(n.channels.url=updateUrl(n.channels.url,a),n.channels.fetch({success:function(){n.pagination.doneLoading()}}))})},searchChannels:function(){var n=this;$("#search-channels").submit(function(e){e.preventDefault();var a,t=$(this).find('input[name="term"]').val(),i=".search-channels .channel-list",c=".search-channels .pagination";if(t.indexOf("category:")>-1){var l=t.replace("category:","");a=baseUrl+"/channels?category="+l,n.fetchChannels(i,a,c)}else a=baseUrl+"/channels?term="+t,n.fetchChannels(i,a,c);n.clearSearch()})},clearSearch:function(){var n=function(){$('#search-channels input[type="text"]').val(""),$(".search-channels").find(".channel-list").empty(),$(".search-channels").find(".pagination").empty(),$(".search-channels").find(".clear").removeClass("dirty")};$(".search-channels .clear").click(n),$(".channels nav").click(n)}});